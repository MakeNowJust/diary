{"data":{"site":{"siteMetadata":{"title":"℘ make now just"}},"markdownRemark":{"html":"<script async src=\"//cdn.embedly.com/widgets/platform.js\"></script>\n<p>プログラミングに対するモチベーションが非常に低下している。</p>\n<h1>やったこと</h1>\n<h2>デフォルト引数に型制約が適用されない問題を修正した</h2>\n<p><a class=\"embedly-card\" href=\"https://github.com/crystal-lang/crystal/pull/3834\">Restrict argument types having a default value by MakeNowJust · Pull Request #3834 · crystal-lang/crystal</a></p>\n<p>例えばこんなコードがあったとする。</p>\n<div class=\"gatsby-highlight\" data-language=\"crystal\"><pre class=\"language-crystal\"><code class=\"language-crystal\"><span class=\"token keyword\">def</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>x <span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\nfoo</code></pre></div>\n<p><code>x : String</code>になってるのに<code>x = 1</code>がデフォルト値になっている、見るからに変なコードなんだけど、現状のコンパイラはこれを通してしまう。というのも、デフォルト値に対する型制約は適用されないから。</p>\n<p>ついでに言うとこういうコードも上手く動かない。</p>\n<div class=\"gatsby-highlight\" data-language=\"crystal\"><pre class=\"language-crystal\"><code class=\"language-crystal\"><span class=\"token keyword\">def</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>x <span class=\"token punctuation\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span> forall <span class=\"token constant\">T</span>\n  p <span class=\"token expansion\"><span class=\"token delimiter tag\">{{</span> <span class=\"token constant\">T</span> <span class=\"token delimiter tag\">}}</span></span>\n<span class=\"token keyword\">end</span>\n\nfoo</code></pre></div>\n<p>型制約のチェックをする際に自由変数の値が設定されるようになってるので。</p>\n<p>どうやって修正したかを簡単に説明すると、<code>TypeRestriction</code>という疑似ノードを追加して、メソッドが実体化されるときに型制約を持つデフォルト引数があったら挿入するようにしている。</p>","fields":{"date":"2017-01-04"},"frontmatter":{"title":"デフォルト引数に型制約が適用されない問題を修正した"},"excerpt":"プログラミングに対するモチベーションが非常に低下している。 やったこと デフォルト引数に型制約が適用されない問題を修正した Restrict argument types having a default value by MakeNowJust · Pull Request …"},"prev":{"fields":{"date":"2017-01-05","slug":"/post/2017-01-05-make-deps-is-back/"},"frontmatter":{"title":"make depsを消してしまったので復活させた"}},"next":{"fields":{"date":"2017-01-03","slug":"/post/2017-01-03-bashcached-5.1.0-each-return-nil/"},"frontmatter":{"title":"bashcachedのv5.1.0をリリースしたり、each系のメソッドがnilを返すようにしたり"}}},"pageContext":{"slug":"/post/2017-01-04-type-restriction-bug/","prevSlug":"/post/2017-01-05-make-deps-is-back/","nextSlug":"/post/2017-01-03-bashcached-5.1.0-each-return-nil/"}}