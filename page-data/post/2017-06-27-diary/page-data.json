{"componentChunkName":"component---src-templates-post-js","path":"/post/2017-06-27-diary/","webpackCompilationHash":"ce3dd97c62c5da663053","result":{"data":{"site":{"siteMetadata":{"title":"℘ make now just"}},"markdownRemark":{"html":"<h1>やったこと</h1>\n<h2><a href=\"https://github.com/crystal-lang/crystal/pull/4627\">#4627</a></h2>\n<p>これ自体はどうやって直せばいいか分かってたので直しておいた。</p>\n<pre><code class=\"hljs language-crystal\">a = <span class=\"hljs-number\">1</span>\n<span class=\"hljs-keyword\">case</span>\n<span class=\"hljs-keyword\">when</span> <span class=\"hljs-number\">2</span>\n<span class=\"hljs-keyword\">else</span>\n  a /= <span class=\"hljs-number\">3</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n<p>のときに、<code>else</code>を処理するところで、<code>/=</code>の前の<code>a</code>が<code>@token</code>になっているところで<code>slash_is_regex!</code>を呼んでから<code>next_token</code>するから、そりゃ<code>/</code>の扱いがおかしくなるよなぁ、っていう。そもそも<code>else</code>の中身を処理する<code>format_nested</code>で<code>skip_space_or_newline</code>してるから、その前でそれをする必要は無いはずなので、それを消して修正完了、のはず。</p>\n<p>ただ、問題は次のissue。</p>\n<h2><a href=\"https://github.com/crystal-lang/crystal/issues/4626\">#4626</a></h2>\n<pre><code class=\"hljs language-crystal\"><span class=\"hljs-number\">1</span> <span class=\"hljs-comment\"># foo</span>\n<span class=\"hljs-regexp\">/ /</span></code></pre>\n<p>みたいなコードが<code>crystal tool format</code>でエラーになるやつ。これは<code>skip_space</code>がコメントの後ろの改行までスキップしてしまうことが原因、なんだけど困ったことにフォーマッタの実装がこの挙動に地味に依存してて、上手く直せる気がしない。</p>\n<p>普通にクリティカルなバグだと思うので直したいんだけど、直る気がしない。しんどい。</p>","fields":{"date":"2017-06-27"},"frontmatter":{"title":"Crystalのフォーマッタとか"},"excerpt":"やったこと #4627 これ自体はどうやって直せばいいか分かってたので直しておいた。 のときに、elseを処理するところで、/=の前のaが@tokenになっているところでslash_is_regex!を呼んでからnext_tokenするから、そりゃ/の扱いがおかしくなるよなぁ、…"},"prev":{"fields":{"date":"2017-06-28","slug":"/post/2017-06-28-diary/"},"frontmatter":{"title":"楽園vol. 24とかケーキバイキングとか"}},"next":{"fields":{"date":"2017-06-26","slug":"/post/2017-06-26-diary/"},"frontmatter":{"title":"ぱらのま1巻を読んだ"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/2017-06-27-diary/","prevSlug":"/post/2017-06-28-diary/","nextSlug":"/post/2017-06-26-diary/"}}}