{"componentChunkName":"component---src-templates-post-js","path":"/post/2017-01-04-type-restriction-bug/","webpackCompilationHash":"6fe4de1bb6408522679c","result":{"data":{"site":{"siteMetadata":{"title":"℘ make now just"}},"markdownRemark":{"html":"<script async src=\"//cdn.embedly.com/widgets/platform.js\"></script>\n<p>プログラミングに対するモチベーションが非常に低下している。</p>\n<h1>やったこと</h1>\n<h2>デフォルト引数に型制約が適用されない問題を修正した</h2>\n<p><a class=\"embedly-card\" href=\"https://github.com/crystal-lang/crystal/pull/3834\">Restrict argument types having a default value by MakeNowJust · Pull Request #3834 · crystal-lang/crystal</a></p>\n<p>例えばこんなコードがあったとする。</p>\n<pre><code class=\"hljs language-crystal\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">foo</span></span>(x : String = <span class=\"hljs-number\">1</span>)\n<span class=\"hljs-keyword\">end</span>\n\nfoo</code></pre>\n<p><code>x : String</code>になってるのに<code>x = 1</code>がデフォルト値になっている、見るからに変なコードなんだけど、現状のコンパイラはこれを通してしまう。というのも、デフォルト値に対する型制約は適用されないから。</p>\n<p>ついでに言うとこういうコードも上手く動かない。</p>\n<pre><code class=\"hljs language-crystal\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">foo</span></span>(x : T.<span class=\"hljs-keyword\">class</span> = String) forall T\n  p <span class=\"hljs-template-variable\">{{ T }}</span>\n<span class=\"hljs-keyword\">end</span>\n\nfoo</code></pre>\n<p>型制約のチェックをする際に自由変数の値が設定されるようになってるので。</p>\n<p>どうやって修正したかを簡単に説明すると、<code>TypeRestriction</code>という疑似ノードを追加して、メソッドが実体化されるときに型制約を持つデフォルト引数があったら挿入するようにしている。</p>","fields":{"date":"2017-01-04"},"frontmatter":{"title":"デフォルト引数に型制約が適用されない問題を修正した"},"excerpt":"プログラミングに対するモチベーションが非常に低下している。やったことデフォルト引数に型制約が適用されない問題を修正したRestrict argument types having a default value by MakeNowJust · Pull Request #38…"},"prev":{"fields":{"date":"2017-01-05","slug":"/post/2017-01-05-make-deps-is-back/"},"frontmatter":{"title":"make depsを消してしまったので復活させた"}},"next":{"fields":{"date":"2017-01-03","slug":"/post/2017-01-03-bashcached-5.1.0-each-return-nil/"},"frontmatter":{"title":"bashcachedのv5.1.0をリリースしたり、each系のメソッドがnilを返すようにしたり"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/2017-01-04-type-restriction-bug/","prevSlug":"/post/2017-01-05-make-deps-is-back/","nextSlug":"/post/2017-01-03-bashcached-5.1.0-each-return-nil/"}}}